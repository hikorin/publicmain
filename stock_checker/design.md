# Webアプリ設計仕様書：StockOps-YF v2.1 (財務・相関統合モデル)

## 1. システム概要
本システムは、`yfinance` ライブラリをデータソースとし、日本株（東証上場銘柄）を対象に「短期的な需給（モメンタム）」と「中期的な企業価値（ファンダメンタルズ）」を二軸で評価・監視するWebアプリケーションである。

---

## 2. 投資戦略の定義とロジック

### 2.1 短期・モメンタム戦略 (Short-term Strategy)
市場全体（日経平均）に対する感応度と、直近の過熱感からエントリー/エグジットを判定する。

* **市場感度（$\beta$値）:** * 日経平均（`^N225`）と個別銘柄の過去20日間の日次収益率を用いた回帰分析。
    * $\beta > 1.2$ を「強気トレンド追随」の条件とする。
* **テクニカル指標:**
    * **RSI (14日):** 30以下（売られすぎ・反発狙い）、80以上（買われすぎ・利確）。
    * **出来高:** 直近5日平均の1.5倍以上の急増を「資金流入」のシグナルとする。

### 2.2 中期・バリューアップ戦略 (Medium-term Strategy)
企業の「稼ぐ力」と「財務健全性」を評価し、適正株価との乖離を狙う。

| 評価カテゴリ | 指標 (yfinance Key) | 判定しきい値 |
| :--- | :--- | :--- |
| **収益性** | `returnOnEquity` (ROE) | 10% 以上 |
| **割安性** | `trailingPE` (PER) | 15倍 以下 |
| **安全性** | `totalStockholderEquity / totalAssets` | 40% 以上 |
| **成長性** | `revenueGrowth` | 前年比 +5% 以上 |

---

## 3. アプリケーション機能仕様

### F-1: 銘柄スキャナー (Scanner)
* 銘柄コードを入力すると、`yfinance` からリアルタイム価格と財務諸表を取得。
* 「短期スコア」と「中期スコア」をそれぞれ100点満点で算出し、判定結果を出力。

### F-2: ポートフォリオ・モニター (Watchlist)
* 保有銘柄の「取得単価」を登録し、現在の損益（％）を表示。
* **アラート機能:** * 損切りライン（短期 $-3\%$ / 中期 $-10\%$）到達時に強調表示。
    * ROEの低下や決算後のPER急騰など、財務上のネガティブ変化を検知。

### F-3: AIリサーチ (AI Research)
* **概要**: Gemini (Generative AI) と Google検索 (Grounding) を活用し、Web上の最新ニュースや市況から有望銘柄を自動発掘する。
* **処理フロー**:
    1. **開始**: ユーザーがAPIキーを入力し「リサーチ開始」ボタンを押下。
    2. **プロンプト読み込み**: `prompt.txt` から分析指示を読み込む。
    3. **AI分析 (Grounding)**: GeminiがGoogle検索を実行し、プロンプトの指示（短期モメンタム/中期ファンダメンタルズ）に基づいて銘柄を選定・分析レポートを作成。
    4. **解析 (Parsing)**: レポートテキストから銘柄コード（例: `（8035）`）を正規表現で抽出。
    5. **統合評価**: 抽出された銘柄コードに対し、本システムのロジック（F-1）を適用し、リアルタイムのスコアと財務指標を表示。

---

## 4. データ構造 (Data Schema)

```json
{
  "stock_code": "8035.T",
  "strategy": "Medium",
  "entry_price": 42000,
  "metrics": {
    "current_beta": 1.45,
    "rsi": 45.2,
    "roe": 0.18,
    "debt_ratio": 0.35
  }
}
```

---

## 5. 環境構築・実行方法 (Setup & Execution)

### 5.1 前提条件
- Python 3.10以上推奨
- Google Gemini APIキー（AIリサーチ機能利用時）

### 5.2 インストール (Installation)
必要なライブラリをインストールします。

```bash
pip install streamlit yfinance pandas plotly google-genai "numpy<2"
```

### 5.3 アプリケーション起動 (Run)
以下のコマンドでWebアプリを起動します。

```bash
streamlit run app.py
```

ブラウザが自動的に開き、`http://localhost:8501` (またはポート番号) にアクセスできます。